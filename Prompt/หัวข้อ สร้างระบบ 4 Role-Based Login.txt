    หัวข้อ: (v8.2 - Master Prompt) สร้างระบบลงทะเบียนเรียน (Full System) ด้วย Laravel, Livewire, และ Spatie

    บริบทของโปรเจกต์ (Tech Stack):
    * Laravel 12
    * Laravel Breeze (ติดตั้งแบบ Blade Stack แล้ว และใช้ Sanctum สำหรับ API)
    * `spatie/laravel-permission` (ติดตั้งและ Publish config/migration แล้ว)
    * `livewire/livewire` (ติดตั้งแล้ว)
    * `sweetalert2` (จะติดตั้งและใช้งาน)
    * `barryvdh/laravel-dompdf` (จะติดตั้งและใช้งาน)

    ---

    ### ส่วนที่ I: การตั้งค่า Database (Schema ที่ฝังไว้)

    1.  **Roles (ภาษาอังกฤษ):**
        * Admin, Teacher, Registrar, Student

    2.  **Spatie Setup:**
        * ตั้งค่า `app/Models/User.php` ให้ใช้ Trait `HasRoles`
        * ใน `bootstrap/app.php` ให้ลงทะเบียน Middleware Aliases ของ Spatie ทั้ง 3 ตัว: `role`, `permission`, และ `role_or_permission`

    3.  **สร้าง Migrations และ Models (ตาม Schema ที่กำหนด):**
        * ให้สร้าง Migrations และ Models สำหรับ Schema v2 ทั้ง 13 ตารางนี้:

        **1. users**
            - id (PK)
            - username: VARCHAR(50)
            - password: VARCHAR(255)
            - email: VARCHAR(100) (unique)
            - role_id: (FK -> roles.id)
            - created_at, updated_at

        **2. roles**
            - id (PK)
            - name: VARCHAR(50) (Admin, Teacher, Registrar, Student)

        **3. students**
            - id (PK)
            - user_id: (FK -> users.id)
            - student_code: VARCHAR(20)
            - firstname: VARCHAR(100)
            - lastname: VARCHAR(100)
            - level_id: (FK -> levels.id)
            - citizen_id: VARCHAR(13)
            - class_group_id: (FK -> class_groups.id)
            - created_at, updated_at

        **4. levels**
            - id (PK)
            - name: VARCHAR(50) (เช่น “ปวช.1”, “ปวส.2”, “ป.ตรี”)
            - created_at, updated_at

        **5. teachers**
            - id (PK)
            - teacher_code: VARCHAR(20)
            - title: VARCHAR(20)
            - firstname: VARCHAR(100)
            - lastname: VARCHAR(100)
            - citizen_id: VARCHAR(13)
            - user_id: (FK -> users.id) (Nullable)
            - created_at, updated_at

        **6. majors**
            - id (PK)
            - major_code: VARCHAR(20)
            - major_name: VARCHAR(100)
            - created_at, updated_at

        **7. class_groups**
            - id (PK)
            - course_group_code: VARCHAR(20)
            - course_group_name: VARCHAR(20)
            - level_id: (FK -> levels.id)
            - level_year: INT
            - major_id: (FK -> majors.id)
            - teacher_advisor_id: (FK -> teachers.id) (Nullable)
            - created_at, updated_at

        **8. subjects**
            - id (PK)
            - subject_code: VARCHAR(20)
            - subject_name: VARCHAR(255) (เช่น "การพัฒนาซอฟต์แวร์รูปแบบเดฟออปส์")
            - credit: DECIMAL(4,2)
            - hour_theory: INT
            - hour_practical: INT
            - created_at, updated_at

        **9. study_plans**
            - id (PK)
            - semester: TINYINT
            - year: INT
            - class_group_id: (FK -> class_groups.id)
            - subject_id: (FK -> subjects.id)
            - teacher_id: (FK -> teachers.id) (Nullable)
            - created_at, updated_at

        **10. registrations**
            - id (PK)
            - student_id: (FK -> students.id)
            - semester: TINYINT
            - year: INT
            - status: ENUM('pending','approved','rejected')
            - registration_card_file: VARCHAR(255) (ไฟล์ "บัตรลงทะเบียน")
            - slip_file_name: VARCHAR(255) (ไฟล์ "ใบแจ้งการชำระเงิน")
            - created_at, updated_at

        **11. tuition_fees**
            - id (PK)
            - semester: TINYINT
            - year: INT
            - fee_name: VARCHAR(100) (เช่น "ค่ากิจกรรมกีฬาสี", "ค่าสมาคมผู้ปกครอง" จาก PDF)
            - rate_money: DECIMAL(10,2)
            - created_at, updated_at

        **12. credit_fees**
            - id (PK)
            - semester: TINYINT
            - year: INT
            - level_id: (FK -> levels.id)
            - credit_fee: DECIMAL(10,2) (สำหรับ "ค่าลงทะเบียนภาคทฤษฎี" จาก PDF)
            - lab_fee: DECIMAL(10,2) (สำหรับ "ค่าลงทะเบียนภาคปฏิบัติ" จาก PDF)
            - created_at, updated_at

        **13. semesters**
            - id (PK)
            - semester: TINYINT
            - year: INT
            - registration_start_date: DATETIME (เช่น "6 พฤษภาคม 2568" จาก PDF)
            - registration_end_date: DATETIME (เช่น "18 พฤษภาคม 2568" จาก PDF)
            - late_registration_start_date: DATETIME (เช่น "19 พฤษภาคม 2568" จาก PDF)
            - late_registration_end_date: DATETIME (เช่น "31 พฤษภาคม 2568" จาก PDF)
            - late_fee_rate: DECIMAL(10,2) (เช่น 100 บาท จาก PDF)
            - is_active: BOOLEAN
            - created_at, updated_at

    4.  **สร้าง Models Relationships:**
        * ในไฟล์ Model ทุกไฟล์ ให้ใส่ Eloquent Relationships ทั้งหมดตาม Schema (เช่น `Student` belongsTo `User`, `ClassGroup` belongsTo `Teacher` as `advisor`)

    ---

    ### ส่วนที่ II: การตั้งค่าข้อมูลพื้นฐาน (Seeding)

    5.  **สร้าง Seeders ทั้งหมด:**
        * `RoleSeeder`: สร้าง Role 4 Role (Admin, Teacher, Registrar, Student) และต้องเรียก `forgetCachedPermissions()`
        * `UserSeeder`: สร้าง 12 Users (Role ละ 3), Password "1234"
        * `LevelSeeder`: สร้าง "ปวช.1", "ปวช.2", "ปวช.3", "ปวส.1", "ปวส.2", "ป.ตรี"
        * `MajorSeeder`: สร้าง "เทคโนโลยีสารสนเทศ", "การบัญชี" ฯลฯ
        * `SubjectSeeder`: สร้างวิชาตัวอย่าง (เช่น "การพัฒนาเว็บแอปพลิเคชั่น", "การพัฒนาซอฟต์แวร์รูปแบบเดฟออปส์" จากไฟล์ PDF)
        * `SemesterSeeder`: สร้างเทอม 1/2568 (ตั้ง `is_active = true`) พร้อมกำหนดวันที่และค่าปรับตาม PDF
        * `TuitionFeeSeeder`: (ใหม่) สร้างรายการค่าบำรุงตาม PDF (เช่น "ค่ากิจกรรมกีฬาสี" 250 บาท)
        * `StudentTeacherLinkSeeder`: (สำคัญ) ค้นหา User (Role Student/Teacher) และสร้างข้อมูลในตาราง `students` / `teachers` ให้เชื่อมกัน
        * `ClassGroupSeeder`: สร้างกลุ่มเรียนตัวอย่าง 1-2 กลุ่ม (เชื่อม Major และ Teacher Advisor)

    6.  **อัปเดต `DatabaseSeeder.php`:**
        * เรียก Seeder ตามลำดับที่ถูกต้อง: Roles -> Users -> Levels/Majors/Subjects/Semesters/TuitionFees -> StudentTeacherLink -> ClassGroups

    ---

    ### ส่วนที่ III: การตั้งค่า Repository และ UI Layout

    7.  **Repository Pattern (โครงสร้าง):**
        * สร้าง `EloquentRepositoryInterface.php`, `EloquentRepository.php`
        * สร้าง Repositories สำหรับ Models ทั้งหมด (เช่น `UserRepository`, `StudentRepository`, `RegistrationRepository`, `ClassGroupRepository` ฯลฯ)

    8.  **โครงสร้าง Layout (Fixed Sidebar):**
        * แก้ไข `layouts/app.blade.php` ให้เป็นแบบ **Fixed Sidebar** (ซ้าย) และ **Content Area** (ขวา) (Sidebar `height: 100vh`, Content `overflow-y: auto`)

    9.  **Sidebar Navigation (`layouts/navigation.blade.php`):**
        * เปลี่ยนจาก Navbar เป็น Logic ของ Sidebar
        * **เมนูย่อย:** ใช้แท็ก `<details>` เพื่อสร้างเมนูแบบพับได้
        * **แสดง User:** ด้านล่างสุดของ Sidebar ให้แสดง "ชื่อ/อีเมล" และปุ่ม "Log Out"
        * **เมนู Profile:** ต้องมีลิงก์ไปยังหน้า `profile.edit` (ของ Breeze)
        * **Active Highlight:** เมนูที่ Active (และ Parent) ต้องมีไฮไลท์
        * **Dynamic Menu (สำคัญ):**
            * `@role('Admin')` -> เมนู "Management" > "Users"
            * `@role('Student')` -> เมนู "ลงทะเบียนเรียน"
            * `@role('Teacher')` -> เมนู "นักเรียนในที่ปรึกษา"
            * `@role('Registrar')` -> เมนู "ตรวจสอบการลงทะเบียน" และ เมนู "จัดการข้อมูลหลัก" (เช่น "Majors", "Subjects", "ClassGroups")

    10. **Content Area (Sticky Header):**
        * ส่วน Header ของเนื้อหา (เช่น "User Management") จะต้อง `position: sticky` และ `top: 0`

    ---

    ### ส่วนที่ IV: การตั้งค่า WEB Functionality (Routes & Livewire)

    11. **WEB Routing (`routes/web.php`):**
        * **Redirect:** Route `/dashboard` ต้อง Redirect User ไปหน้าของตัวเอง (เช่น Admin ไป `admin.dashboard`)
        * **Blocking:** สร้าง Route Group สำหรับแต่ละ Role (เช่น `prefix('admin')->middleware('role:Admin')`, `prefix('student')->middleware('role:Student')` ฯลฯ)
        * **Fallback:** เพิ่ม `Route::fallback()` ที่ท้ายไฟล์เพื่อแสดงหน้า 403

    12. **สร้าง Livewire Components (ทั้งหมด):**
        * (Admin) `Admin\UserManagement`: CRUD ตาราง `users` (ตาม v6)
        * (Student) `Student\RegistrationUpload`:
            * แสดงปุ่ม "ดาวน์โหลด PDF"
            * ฟอร์มอัปโหลดไฟล์ 2 ช่อง (สร้าง `registrations` status 'pending')
            * แสดงประวัติของตัวเอง
        * (Registrar) `Registrar\ApproveRegistrations`:
            * แสดงตาราง `registrations` (status 'pending')
            * Modal ตรวจสอบ (แสดงลิงก์ไฟล์สลิป)
            * ปุ่ม "Approve" (status 'approved') / "Reject" (status 'rejected')
        * (Teacher) `Teacher\ViewStudents`:
            * แสดงรายชื่อ `students` ทั้งหมดที่ `teacher_advisor_id` ตรงกับตัวเอง
            * แสดง `registrations.status` ของเทอมปัจจุบันข้างชื่อนักเรียน
        * (Registrar) `Registrar\ManageMajors`: CRUD ตาราง `majors`
        * (Registrar) `Registrar\ManageSubjects`: CRUD ตาราง `subjects`
        * (Registrar) `Registrar\ManageClassGroups`: CRUD ตาราง `class_groups`
        * (Registrar) `Registrar\ManageSemesters`: CRUD ตาราง `semesters`
        * (UI/UX) Components ทั้งหมดต้องใช้ Repository, Modal (สำหรับ Form), และ SweetAlert2 (สำหรับ Success/Delete Confirmation)

    ---

    ### ส่วนที่ V: การตั้งค่า API และ PDF

    13. **API Routing (`routes/api.php`):**
        * ป้องกันด้วย `auth:sanctum`
        * `GET /user` (ของ Sanctum)
        * `GET /users` (Admin, Registrar)
        * `POST /users` (Admin)
        * `GET /users/{id}` (Admin, Registrar)
        * `PUT /users/{id}` (Admin) (ต้องรองรับการ `syncRoles()`)
        * `DELETE /users/{id}` (Admin)

    14. **API Controller (`APIs\UserController.php`):**
        * ต้อง Inject `UserRepository`
        * ต้องมี Error Handling (404 Not Found)

    15. **PDF Generation (`PdfController.php`):**
        * สร้าง `PdfController` ที่มี Method `downloadRegistrationForm()`
        * Logic: ดึงข้อมูลนักเรียน, `study_plan`, `tuition_fees`, `credit_fees`
        * สร้าง Blade View (`pdf/registration-form.blade.php`)
        * Return `PDF::loadView(...)`

    ---

    ### สิ่งที่ต้องการจากคุณ (Output):

    โปรดให้โค้dและขั้นตอนทั้งหมดสำหรับไฟล์เหล่านี้:
    1.  ไฟล์ Migrations ทั้งหมด (13 ไฟล์)
    2.  ไฟล์ Models ทั้งหมด (13 ไฟล์) พร้อม Eloquent Relationships
    3.  ไฟล์ Repositories (Interface, Base, และสำหรับทุก Model)
    4.  ไฟล์ Seeders ทั้งหมด (Role, User, Level, Major, Subject, Semester, TuitionFeeSeeder, StudentTeacherLink, ClassGroup)
    5.  การแก้ไข `DatabaseSeeder.php`
    6.  การแก้ไข `bootstrap/app.php` (สำหรับ Middleware)
    7.  `routes/web.php` (ฉบับเต็ม)
    8.  `routes/api.php` (ฉบับเต็ม)
    9.  `app/Http/Controllers/APIs/UserController.php`
    10. `app/Http/Controllers/PdfController.php` และ `resources/views/pdf/registration-form.blade.php`
    11. `resources/views/layouts/app.blade.php` (Layout ที่มี Sidebar)
    12. `resources/views/layouts/navigation.blade.php` (Logic ของ Sidebar)
    13. Class + View ของ Livewire Component ทั้งหมด (UserManagement, RegistrationUpload, ApproveRegistrations, ViewStudents, ManageMajors, ManageSubjects, ManageClassGroups, ManageSemesters)
    14. (อธิบาย) วิธีเชื่อมต่อ SweetAlert2 กับ Livewire Events